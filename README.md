# Calendar Design - æ—¥å†å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„æ—¥å†å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæœˆ/å‘¨/æ—¥è§†å›¾ã€ä»»åŠ¡ç®¡ç†ã€æ¨¡æ¿åŠŸèƒ½ï¼Œå¹¶é›†æˆäº†KMSåŠ å¯†ç³»ç»Ÿä¿æŠ¤æ•æ„Ÿæ•°æ®ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)
- [KMSåŠ å¯†ç³»ç»Ÿ](#kmsåŠ å¯†ç³»ç»Ÿ)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [éƒ¨ç½²è¯´æ˜](#éƒ¨ç½²è¯´æ˜)

---

## é¡¹ç›®ç®€ä»‹

Calendar Design æ˜¯ä¸€ä¸ªåŸºäºSpring Bootå¼€å‘çš„æ—¥å†å¾…åŠäº‹é¡¹ç®¡ç†ç³»ç»Ÿï¼Œæä¾›å®Œæ•´çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ“… å¤šè§†å›¾æ—¥å†å±•ç¤ºï¼ˆæœˆ/å‘¨/æ—¥ï¼‰
- âœ… å¾…åŠäº‹é¡¹ç®¡ç†ï¼ˆåˆ›å»ºã€æ›´æ–°ã€å®Œæˆã€åˆ é™¤ï¼‰
- ğŸ·ï¸ ä»»åŠ¡åˆ†ç±»å’Œæ ‡ç­¾
- ğŸ“ ä»»åŠ¡æ¨¡æ¿åŠŸèƒ½
- ğŸ“Š æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
- ğŸ” KMSåŠ å¯†ç³»ç»Ÿä¿æŠ¤æ•æ„Ÿæ•°æ®
- ğŸ‘¤ ç”¨æˆ·è®¤è¯å’Œæˆæƒ

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ—¥å†è§†å›¾

- **æœˆè§†å›¾**ï¼šæ˜¾ç¤ºæ•´æœˆçš„ä»»åŠ¡åˆ†å¸ƒå’Œå®Œæˆæƒ…å†µ
- **å‘¨è§†å›¾**ï¼šæ˜¾ç¤ºä¸€å‘¨å†…çš„è¯¦ç»†ä»»åŠ¡åˆ—è¡¨
- **æ—¥è§†å›¾**ï¼šæ˜¾ç¤ºå•æ—¥çš„ä»»åŠ¡æ—¶é—´å®‰æ’

### 2. ä»»åŠ¡ç®¡ç†

- åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ä»»åŠ¡
- ä»»åŠ¡çŠ¶æ€ç®¡ç†ï¼ˆå¾…åŠ/å·²å®Œæˆï¼‰
- ä»»åŠ¡åˆ†ç±»å’Œç±»å‹ç®¡ç†
- ä»»åŠ¡å¤‡æ³¨å’Œé™„ä»¶æ”¯æŒ
- ä»»åŠ¡é‡å¤è§„åˆ™ï¼ˆæ¯æ—¥/æ¯å‘¨/æ¯æœˆï¼‰

### 3. æ¨¡æ¿åŠŸèƒ½

- åˆ›å»ºä»»åŠ¡æ¨¡æ¿
- ä»æ¨¡æ¿å¿«é€Ÿåˆ›å»ºä»»åŠ¡
- æ¨¡æ¿é¡¹ç®¡ç†

### 4. æ•°æ®ç»Ÿè®¡

- æœˆåº¦å®Œæˆç‡ç»Ÿè®¡
- æŒ‰ç±»å‹ç»Ÿè®¡ä»»åŠ¡åˆ†å¸ƒ
- å®Œæˆç‡è¶‹åŠ¿åˆ†æ

### 5. å®‰å…¨åŠ å¯†

- KMSåŠ å¯†ç³»ç»Ÿä¿æŠ¤æ•æ„Ÿæ•°æ®
- Todoæ ‡é¢˜å’Œæè¿°è‡ªåŠ¨åŠ å¯†
- ç”¨æˆ·æ‰‹æœºå·å’Œé‚®ç®±è‡ªåŠ¨åŠ å¯†
- æ³¨è§£å¼åŠ å¯†ï¼Œæ˜“äºæ‰©å±•

## æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶

- **Spring Boot 3.5.3** - åº”ç”¨æ¡†æ¶
- **Spring Data JPA** - æ•°æ®æŒä¹…åŒ–
- **Spring AOP** - åˆ‡é¢ç¼–ç¨‹ï¼ˆåŠ å¯†åŠŸèƒ½ï¼‰
- **H2 Database** - åµŒå…¥å¼æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### æ ¸å¿ƒä¾èµ–

- **Lombok** - ç®€åŒ–Javaä»£ç 
- **Hutool** - Javaå·¥å…·ç±»åº“
- **Spring Security Crypto** - å¯†ç åŠ å¯†
- **Jakarta Persistence** - JPAè§„èŒƒ

### åŠ å¯†æŠ€æœ¯

- **AES-256-GCM** - å¯¹ç§°åŠ å¯†ç®—æ³•
- **KMS** - å¯†é’¥ç®¡ç†æœåŠ¡
- **BCrypt** - å¯†ç å“ˆå¸Œ

## é¡¹ç›®ç»“æ„

```
calendar-design/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/cn/barcke/
â”‚   â”‚   â”‚   â”œâ”€â”€ annotation/          # æ³¨è§£å®šä¹‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EncryptField.java
â”‚   â”‚   â”‚   â”œâ”€â”€ aspect/              # AOPåˆ‡é¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ EncryptionAspect.java
â”‚   â”‚   â”‚   â”œâ”€â”€ common/              # é€šç”¨ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BarckeContext.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CommonException.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Result.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ResultEnum.java
â”‚   â”‚   â”‚   â”œâ”€â”€ config/              # é…ç½®ç±»
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ WebMvcConfig.java
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/          # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TodoController.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ dao/                 # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TodoRepository.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserRepository.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ todo/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ exception/           # å¼‚å¸¸å¤„ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptor/         # æ‹¦æˆªå™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AuthInterceptor.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CORSSignatureInterceptor.java
â”‚   â”‚   â”‚   â”œâ”€â”€ pojo/                # å®ä½“ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Todo.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserInfo.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserKey.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ service/             # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ impl/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TodoServiceImpl.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ KmsServiceImpl.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ tool/                # å·¥å…·ç±»
â”‚   â”‚   â”‚       â”œâ”€â”€ EncryptionUtil.java
â”‚   â”‚   â”‚       â””â”€â”€ JwtTool.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml       # é…ç½®æ–‡ä»¶
â”‚   â”‚       â””â”€â”€ banner.txt
â”‚   â””â”€â”€ test/                         # æµ‹è¯•ä»£ç 
â”œâ”€â”€ doc/                              # æ–‡æ¡£ç›®å½•
â”‚   â””â”€â”€ KMSåŠ å¯†ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£.md
â”œâ”€â”€ pom.xml                           # Mavené…ç½®
â””â”€â”€ README.md                         # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- JDK 21+
- Maven 3.6+
- H2 Databaseï¼ˆå·²åŒ…å«ï¼‰

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd calendar-design
```

### 2. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `src/main/resources/application.yml`ï¼š

```yaml
spring:
  datasource:
    url: jdbc:h2:file:/tmp/h2/testdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password:
```

### 3. é…ç½®KMSï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `src/main/resources/application.yml`ï¼š

```yaml
kms:
  masterKey: YOUR_BASE64_ENCODED_32_BYTE_KEY
  enabled: true
```

### 4. ç¼–è¯‘è¿è¡Œ

```bash
# ç¼–è¯‘
mvn clean package

# è¿è¡Œ
mvn spring-boot:run
```

### 5. è®¿é—®åº”ç”¨

- åº”ç”¨åœ°å€ï¼šhttp://localhost:6158/api/
- H2æ§åˆ¶å°ï¼šhttp://localhost:6158/api/h2-console

## APIæ–‡æ¡£

### è®¤è¯ç›¸å…³

#### ç”¨æˆ·æ³¨å†Œ

```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}
```

#### ç”¨æˆ·ç™»å½•

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "password123"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "user-id",
      "username": "testuser",
      "nickname": null,
      "email": null,
      "phone": null
    }
  }
}
```

### ä»»åŠ¡ç®¡ç†

#### åˆ›å»ºä»»åŠ¡

```http
POST /api/todo
Authorization: BARCKE-TOKEN <token>
Content-Type: application/json

{
  "title": "å®Œæˆé¡¹ç›®æ–‡æ¡£",
  "description": "ç¼–å†™READMEå’ŒAPIæ–‡æ¡£",
  "date": "2025-12-20",
  "time": "14:00:00",
  "typeId": "type-id",
  "repeatType": "none"
}
```

#### æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨

```http
GET /api/todo?date=2025-12-20
Authorization: BARCKE-TOKEN <token>
```

#### æ›´æ–°ä»»åŠ¡

```http
PUT /api/todo/{id}
Authorization: BARCKE-TOKEN <token>
Content-Type: application/json

{
  "title": "æ›´æ–°åçš„ä»»åŠ¡æ ‡é¢˜",
  "status": "completed"
}
```

#### å®Œæˆä»»åŠ¡

```http
POST /api/todo/{id}/complete
Authorization: BARCKE-TOKEN <token>
```

#### åˆ é™¤ä»»åŠ¡

```http
DELETE /api/todo/{id}
Authorization: BARCKE-TOKEN <token>
```

### æ—¥å†è§†å›¾

#### è·å–æœˆè§†å›¾

```http
GET /api/calendar/month?yearMonth=2025-12
Authorization: BARCKE-TOKEN <token>
```

#### è·å–æ—¥è§†å›¾

```http
GET /api/calendar/day?date=2025-12-20
Authorization: BARCKE-TOKEN <token>
```

#### è·å–å‘¨è§†å›¾

```http
GET /api/calendar/week?weekStartDate=2025-12-15
Authorization: BARCKE-TOKEN <token>
```

### ç»Ÿè®¡åŠŸèƒ½

#### è·å–æœˆåº¦ç»Ÿè®¡

```http
GET /api/statistics/month?yearMonth=2025-12
Authorization: BARCKE-TOKEN <token>
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "data": {
    "month": "2025-12",
    "totalCount": 30,
    "completedCount": 20,
    "completionRate": 0.67
  }
}
```

## KMSåŠ å¯†ç³»ç»Ÿ

ç³»ç»Ÿé›†æˆäº†å®Œæ•´çš„KMSåŠ å¯†ç³»ç»Ÿï¼Œè‡ªåŠ¨ä¿æŠ¤æ•æ„Ÿæ•°æ®ã€‚è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒï¼š[KMSåŠ å¯†ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£](./doc/KMSåŠ å¯†ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£.md)

### åŠ å¯†å­—æ®µ

- **Todoå®ä½“**ï¼š`title`ã€`description`
- **UserInfoå®ä½“**ï¼š`email`ã€`phone`

### ä½¿ç”¨æ–¹å¼

åœ¨å®ä½“ç±»å­—æ®µä¸Šæ·»åŠ `@EncryptField`æ³¨è§£å³å¯è‡ªåŠ¨åŠ å¯†ï¼š

```java
@Entity
public class Todo {
    @EncryptField
    @Column(name = "title")
    private String title;
}
```

### å¯†é’¥ç®¡ç†

- æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„åŠ å¯†å¯†é’¥
- å¯†é’¥ä½¿ç”¨ä¸»å¯†é’¥åŠ å¯†åå­˜å‚¨
- æ”¯æŒå¯†é’¥ç‰ˆæœ¬ç®¡ç†å’Œè½®æ¢

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **åˆ›å»ºå®ä½“ç±»**ï¼šåœ¨`pojo`åŒ…ä¸‹åˆ›å»ºå®ä½“
2. **åˆ›å»ºRepository**ï¼šåœ¨`dao`åŒ…ä¸‹åˆ›å»ºRepositoryæ¥å£
3. **åˆ›å»ºService**ï¼šåœ¨`service`åŒ…ä¸‹åˆ›å»ºServiceæ¥å£å’Œå®ç°
4. **åˆ›å»ºController**ï¼šåœ¨`controller`åŒ…ä¸‹åˆ›å»ºController
5. **åˆ›å»ºDTO**ï¼šåœ¨`dto`åŒ…ä¸‹åˆ›å»ºè¯·æ±‚/å“åº”DTO

### æ·»åŠ åŠ å¯†å­—æ®µ

åœ¨å®ä½“ç±»å­—æ®µä¸Šæ·»åŠ `@EncryptField`æ³¨è§£ï¼š

```java
@EncryptField
@Column(name = "sensitive_field")
private String sensitiveField;
```

### ä»£ç è§„èŒƒ

- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
- éµå¾ªRESTful APIè®¾è®¡è§„èŒƒ
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ˆResultç±»ï¼‰

## éƒ¨ç½²è¯´æ˜

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. **æ•°æ®åº“é…ç½®**ï¼šä½¿ç”¨MySQLæˆ–PostgreSQLæ›¿ä»£H2
2. **KMSä¸»å¯†é’¥**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
3. **JWTå¯†é’¥**ï¼šä½¿ç”¨å¼ºéšæœºå¯†é’¥
4. **æ—¥å¿—é…ç½®**ï¼šé…ç½®æ—¥å¿—çº§åˆ«å’Œè¾“å‡º

### Dockeréƒ¨ç½²ï¼ˆç¤ºä¾‹ï¼‰

```dockerfile
FROM openjdk:21-jre-slim
COPY target/agile-dev.jar app.jar
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### ç¯å¢ƒå˜é‡

```bash
# æ•°æ®åº“é…ç½®
SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/calendar
SPRING_DATASOURCE_USERNAME=root
SPRING_DATASOURCE_PASSWORD=password

# KMSé…ç½®
KMS_MASTER_KEY=your_base64_encoded_key
KMS_ENABLED=true

# JWTé…ç½®
JWT_SECRET=your_jwt_secret
JWT_EXPIRATION=86400
```

## é¡¹ç›®ç‰¹æ€§

### å®‰å…¨æ€§

- âœ… JWTè®¤è¯æœºåˆ¶
- âœ… å¯†ç BCryptåŠ å¯†
- âœ… KMSæ•°æ®åŠ å¯†
- âœ… ç”¨æˆ·çº§å¯†é’¥éš”ç¦»
- âœ… æ•æ„Ÿæ•°æ®è‡ªåŠ¨åŠ å¯†

### æ€§èƒ½ä¼˜åŒ–

- âœ… åŠ å¯†å­—æ®µç¼“å­˜
- âœ… æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–

### å¯æ‰©å±•æ€§

- âœ… æ³¨è§£å¼åŠ å¯†æ‰©å±•
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… æ¥å£æŠ½è±¡

## ç‰ˆæœ¬å†å²

### v1.0 (2025/12/16)

- âœ… åŸºç¡€åŠŸèƒ½å®ç°
- âœ… æ—¥å†è§†å›¾ï¼ˆæœˆ/å‘¨/æ—¥ï¼‰
- âœ… ä»»åŠ¡ç®¡ç†
- âœ… æ¨¡æ¿åŠŸèƒ½
- âœ… ç»Ÿè®¡åŠŸèƒ½
- âœ… KMSåŠ å¯†ç³»ç»Ÿ
- âœ… ç”¨æˆ·è®¤è¯

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

- ä½œè€…ï¼šBarcke

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œå‚è€ƒä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒè¯·æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œå®‰å…¨åŠ å›ºå’Œæ€§èƒ½ä¼˜åŒ–ã€‚

